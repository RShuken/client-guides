<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vishnu Work Done - Ian Ferguson Project</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; max-width: 900px; margin: 40px auto; }
        h1 { color: #2c3e50; }
        h2 { color: #34495e; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
        .date { color: #7f8c8d; font-style: italic; margin-bottom: 24px; }
        .section { margin: 20px 0; }
        .code-block { background-color: #f8f9fa; border-left: 4px solid #3498db; padding: 10px; margin: 10px 0; font-size: 0.9em; overflow-x: auto; }
        .command { font-family: monospace; background-color: #333; color: #fff; padding: 2px 4px; }
        code { background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-size: 0.9em; }

        /* Work items with collapsible details */
        .work-item { border: 1px solid #e0e0e0; margin: 15px 0; border-radius: 8px; overflow: hidden; }
        .work-item summary {
            padding: 15px;
            cursor: pointer;
            background: #fafafa;
            border-bottom: 1px solid #e0e0e0;
            list-style: none;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .work-item summary::-webkit-details-marker { display: none; }
        .work-item summary::before {
            content: 'â–¶';
            font-size: 0.7em;
            transition: transform 0.2s;
            flex-shrink: 0;
        }
        .work-item[open] summary::before { transform: rotate(90deg); }
        .work-item[open] summary { border-bottom: 1px solid #e0e0e0; }
        .work-item .details-body { padding: 15px; }
        .work-date { font-weight: bold; color: #27ae60; font-size: 0.85em; white-space: nowrap; }
        .work-title { font-weight: 600; color: #2c3e50; font-size: 1.05em; }
        .work-summary { color: #666; font-size: 0.9em; margin-left: auto; }

        /* Status badges */
        .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.75em; font-weight: 600; }
        .badge-fix { background: #fee2e2; color: #991b1b; }
        .badge-config { background: #dbeafe; color: #1e40af; }
        .badge-setup { background: #d1fae5; color: #065f46; }

        @media (max-width: 640px) {
            body { margin: 16px; }
            .work-item summary { flex-wrap: wrap; }
            .work-summary { display: none; }
        }
    </style>
</head>
<body>
    <h1>Vishnu Work Done Log</h1>
    <div class="date">Tracking all work performed on Ian Ferguson's Vishnu AI Assistant</div>

    <!-- â”€â”€â”€ Feb 3: Context Overflow Fix â”€â”€â”€ -->
    <details class="work-item" open>
        <summary>
            <span class="work-date">Feb 3, 2026 â€” 4:37 PM</span>
            <span class="work-title">ðŸ”¥ Context Overflow â€” Root Cause &amp; Fix</span>
            <span class="badge badge-fix">FIX</span>
        </summary>
        <div class="details-body">
            <h4>Problem</h4>
            <p>Vishnu was experiencing recurring <strong>context overflow errors</strong> and <strong>API rate limit failures (HTTP 429)</strong>. After investigation, we discovered the root cause: <strong>Ian had shared his entire conversation history from ChatGPT and Claude with Vishnu</strong>, asking it to save everything permanently.</p>

            <h4>Root Cause</h4>
            <p>A transcribed voice message confirmed Ian asked Vishnu to <em>"take all this information and save it and make sure that it's in a place you can reference forever."</em> This caused:</p>
            <ol>
                <li><strong>Memory Database Bloat:</strong> main.sqlite grew to 5.1 MB with 89 embedding entries (vs 4 in a clean database)</li>
                <li><strong>Context Inflation:</strong> Every interaction searched the bloated index, pulling in years of historical context</li>
                <li><strong>Concurrent Session Overload:</strong> Multiple sessions each carrying inflated context triggered cascading rate limits</li>
            </ol>

            <h4>Pre-Fix State</h4>
            <div class="code-block">
                <strong>main.sqlite:</strong> 5.1 MB (89 embeddings, 1,429,546 bytes)<br>
                <strong>hanna.sqlite:</strong> 3.2 MB (4 embeddings â€” healthy baseline)<br>
                <strong>Embedding ratio:</strong> 22:1 main vs hanna<br>
                <strong>Sessions:</strong> 30-48% capacity each, cascading to rate limits
            </div>

            <h4>Fix Applied</h4>
            <div class="code-block">
                <span class="command">cp main.sqlite main.sqlite.bak</span> &nbsp;# backup<br>
                <span class="command">cp hanna.sqlite hanna.sqlite.bak</span> &nbsp;# backup<br>
                <span class="command">rm main.sqlite hanna.sqlite</span> &nbsp;# remove bloated DBs<br>
                # System auto-rebuilds fresh, minimal databases on next use
            </div>

            <h4>Post-Fix Validation</h4>
            <ul>
                <li>âœ… Database size: 5.1 MB â†’ 0 (rebuilds under 100 KB)</li>
                <li>âœ… Embeddings: 89 â†’ 0 (rebuilds with ~6 from current files)</li>
                <li>âœ… Memory search: Working â€” returns only current, relevant data</li>
                <li>âœ… Backups preserved for recovery if needed</li>
            </ul>

            <h4>Lessons Learned</h4>
            <ol>
                <li>Never bulk-import conversation history from other AI platforms â€” summarize key points instead</li>
                <li>Embedding databases grow silently (5.1 MB DB had only 8 KB of readable text)</li>
                <li>Concurrent sessions multiply memory bloat into rate limit cascades</li>
            </ol>
        </div>
    </details>

    <!-- â”€â”€â”€ Feb 3: Rate Limit Optimization â”€â”€â”€ -->
    <details class="work-item">
        <summary>
            <span class="work-date">Feb 3, 2026 â€” 12:25 PM</span>
            <span class="work-title">API Rate Limit Optimization</span>
            <span class="badge badge-config">CONFIG</span>
        </summary>
        <div class="details-body">
            <h4>Problem</h4>
            <p>Vishnu was hitting Anthropic API rate limits (HTTP 429), falling back to Gemini despite having Tier 2 limits (450k tokens/min, 1k requests/min).</p>

            <h4>Solution</h4>
            <ol>
                <li><strong>Reordered Fallback Chain:</strong> Opus â†’ Gemini â†’ Sonnet â†’ GPT-4o (Gemini moved up as faster fallback)</li>
                <li><strong>Preserved Concurrency:</strong> Kept all 4 concurrent agents</li>
                <li><strong>Smart Retry Logic:</strong> 3-minute cooldowns to prevent retry loops</li>
            </ol>

            <h4>Commands</h4>
            <div class="code-block">
                <span class="command">cp ~/.clawdbot/clawdbot.json ~/.clawdbot/clawdbot.json.backup.$(date +%s)</span><br>
                # Updated fallbacks in config: ["gemini-3-pro-preview", "claude-sonnet-4", "gpt-4o"]<br>
                <span class="command">clawdbot gateway restart</span>
            </div>

            <h4>Result</h4>
            <p>When Claude hits rate limits: tries Gemini first (fast), then Sonnet, then GPT-4o. 3-min cooldown prevents retry storms.</p>
        </div>
    </details>

    <!-- â”€â”€â”€ Feb 1-2: Initial Setup â”€â”€â”€ -->
    <details class="work-item">
        <summary>
            <span class="work-date">Feb 1â€“2, 2026</span>
            <span class="work-title">Initial Setup &amp; Configuration</span>
            <span class="badge badge-setup">SETUP</span>
        </summary>
        <div class="details-body">
            <h4>Work Completed</h4>
            <ul>
                <li>undici installed for ClawdHub on Node v25</li>
                <li>Browser set to use clawd profile</li>
                <li>Cooldowns reduced from 1hr â†’ 3min</li>
                <li>Stuck cooldown state cleared</li>
                <li>$60 loaded â†’ Tier 2 rate limits</li>
                <li>Local embeddings for memory search</li>
                <li>Full explainer website created</li>
            </ul>

            <h4>Configuration</h4>
            <ul>
                <li><strong>Primary Model:</strong> Claude Opus 4.5</li>
                <li><strong>Fallback Chain:</strong> Opus 4.5 â†’ Sonnet 4 â†’ Gemini 3 Pro â†’ GPT-4o</li>
                <li><strong>API Tier:</strong> Tier 2 ($60) â€” 450k tokens/min, 1k requests/min</li>
                <li><strong>Features:</strong> Web search, browser, heartbeat, nightshift, memory, multi-provider failover</li>
            </ul>
        </div>
    </details>

    <div class="section">
        <h2>About Vishnu</h2>
        <p>Vishnu is Ian Ferguson's personal AI assistant running 24/7 on his Mac Mini. It operates through Telegram (@Vishnuexu_bot) and provides advanced AI capabilities including coding, research, file processing, and contextual memory.</p>
    </div>
</body>
</html>
